{% extends "base.html" %}

{% block content %}
<div class="container" style="max-width: 900px; margin: 40px auto;">
    <h1>Content Analysis</h1>

    <!-- Content Summary -->
    <div class="card" style="margin-bottom: 30px;">
        <div class="card__header">
            <h3>{{ content.id }} - Analysis Summary</h3>
        </div>
        <div class="card__body">
            <p><strong>Submitted:</strong> {{ content.created_at|date:"M d, Y H:i" }}</p>
            <p><strong>Trust Score:</strong> <span style="font-size: 24px; color: #21808D;">{{ content.trust_score|floatformat:2 }}</span></p>
            <p><strong>Total Claims Extracted:</strong> {{ total_claims }}</p>
            <p><strong>Average Claim Confidence:</strong> {{ avg_confidence|floatformat:2 }}</p>
        </div>
    </div>

    <!-- Original Content -->
    <div class="card" style="margin-bottom: 30px;">
        <div class="card__header">
            <h3>Original Content</h3>
        </div>
        <div class="card__body">
            <p style="line-height: 1.6; color: #666;">{{ content.raw_text }}</p>
        </div>
    </div>

    <!-- Extracted Claims -->
    <div class="card" style="margin-bottom: 30px;">
        <div class="card__header">
            <h3>Extracted Claims ({{ total_claims }})</h3>
        </div>
        <div class="card__body">
            {% if claims %}
                <div style="display: grid; gap: 15px;">
                    {% for claim in claims %}
                    <div style="padding: 12px; background: #f5f5f5; border-radius: 6px; border-left: 4px solid #21808D;">
                        <p style="margin: 0 0 8px 0; font-weight: 500;">{{ claim.claim_text }}</p>
                        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; font-size: 12px;">
                            <div>
                                <strong>Confidence:</strong> {{ claim.confidence|floatformat:2 }}
                            </div>
                            <div>
                                <strong>Type:</strong> {{ claim.source_type|title }}
                            </div>
                            <div>
                                {% if claim.is_negated %}
                                <span style="color: #e74c3c;">⚠️ Negated</span>
                                {% else %}
                                <span style="color: #27ae60;">✓ Affirmed</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            {% else %}
                <p style="color: #999;">No claims extracted yet. Processing may still be running...</p>
            {% endif %}
        </div>
    </div>

    <!-- Contradictions -->
    {% if contradictions %}
    <div class="card" style="margin-bottom: 30px;">
        <div class="card__header">
            <h3>⚠️ Contradictions Found ({{ contradictions.count }})</h3>
        </div>
        <div class="card__body">
            <div style="display: grid; gap: 15px;">
                {% for contradiction in contradictions %}
                <div style="padding: 12px; background: #fee; border-radius: 6px; border-left: 4px solid #e74c3c;">
                    <p style="margin: 0 0 8px 0; font-weight: 500; color: #c0152f;">Contradiction Detected</p>
                    <div style="display: grid; gap: 8px; font-size: 13px;">
                        <div>
                            <strong>Claim 1:</strong> {{ contradiction.claim_a.claim_text }}
                        </div>
                        <div>
                            <strong>Claim 2:</strong> {{ contradiction.claim_b.claim_text }}
                        </div>
                        <div>
                            <strong>Confidence:</strong> {{ contradiction.confidence|floatformat:2 }}
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Action Buttons -->
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 30px 0;">
        <a href="{% url 'submit_page' %}" class="btn btn--secondary" style="text-align: center; text-decoration: none;">Submit Another</a>
        <a href="{% url 'dashboard' %}" class="btn btn--primary" style="text-align: center; text-decoration: none;">Back to Dashboard</a>
        <a href="{% url 'content_pdf' content.id %}" class="btn btn--secondary" style="text-align: center; text-decoration: none;">Download PDF</a>
    </div>

</div>
{% endblock %}
